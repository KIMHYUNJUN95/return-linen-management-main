Replit 개발 슈퍼프롬프트 (붙여넣기용)
0) 목표

기존 웹 전면 리뉴얼: 기존 파일의 코드 흐름/로직을 100% 유지하면서 UI/UX 리디자인 및 모듈화.

기능 보존 + 신규 기능 추가(아래 상세 요구).

PWA 설치형(iOS/Android 모두 설치 가능): manifest.json, service-worker.js 구성 및 오프라인 캐시/아이콘.

3D 객체가 움직이는 미래지향적 배경: 성능 가벼운 WebGL/Canvas(우선 Three.js, 저사양 폴백).

반응형: 모바일/PC 모두 최적화. 모바일에서 글자/레이아웃/입력칸 겹침 금지.

푸터(앱 최하단) 항상 표시: HARU_KIM HYUN JUN.

1) 하드 요구사항/제약

Firebase 프로젝트 키, 스토리지/Firestore 경로, 인증 흐름, GitHub 주소 – 절대 변경 금지.

기존 레포 경로/브랜치/페이지 배포 흐름 유지.

firebaseConfig 또는 storage.js에 있는 연결 정보는 그대로 import.

기존 파일 구조 및 네이밍 유지, 단: 공통 컴포넌트/유틸/스타일 분리는 “추가”로만 실시(기존 호출부는 래퍼로 연결).

데이터 스키마는 호환: 신규 필드는 하위 호환으로 추가(마이그레이션 필요 시 Cloud Functions로 add-only).

권한/보안: Firestore 룰/서버 함수로 본인글만 수정/삭제, 관리자는 전체 권한.

2) 기술 스택/설정

Vanilla JS 또는 모듈식 ES Modules 유지(프레임워크 미사용 전제). 필요 시 경량 라이브러리만 사용.

스타일: CSS 변수 기반 디자인 토큰 + 유틸 클래스로 재사용.

3D 배경: Three.js(모바일 성능 저하 시 static gradient 폴백).

PWA: manifest.json, service-worker.js (Workbox 없이 기본 캐시전략).

빌드 없이 동작하도록 설계(ESM CDN 사용 가능).

내보내기(CSV/Excel/PDF):

CSV: 직접 직렬화

Excel: SheetJS(xlsx)

PDF: jsPDF + autoTable

3) 파일 구조(추가/리팩토링)

기존 파일은 그대로 유지. 아래는 추가 파일(또는 분리 권장) 목록:

/pwa/manifest.json

/pwa/service-worker.js

/assets/icons/* (PWA 아이콘)

/styles/tokens.css (색/폰트/간격 토큰)

/styles/layout.css (공통 레이아웃/그리드/반응형)

/styles/components.css (버튼, 카드, 모달 등)

/scripts/core/auth.js (기존 auth 래핑, displayName 자동 주입)

/scripts/core/db.js (기존 Firestore/Storage 호출 공통화: 기존 함수는 여기로 위임)

/scripts/core/export.js (CSV/Excel/PDF 유틸)

/scripts/core/roles.js (권한/롤 헬퍼: isOwner, isAdmin)

/scripts/core/ui.js (모달/토스트/로더)

/scripts/bg/scene.js (Three.js 배경, 폴백 제공)

/scripts/jobs/midnightReset.js (근무기록 자정 리셋 Cloud Function 트리거 설명/엔드포인트 호출)

기존 각 페이지 JS는 호출부만 유지하고 내부 로직은 위 공통 유틸을 사용하도록 래핑.

구현 시 주의: 기존 HTML/JS import 경로는 깨지지 않게 유지. 신규 유틸은 뒤에서 로드해서 기존 함수 시그니처를 보존한 어댑터를 제공.

4) 공통 UI/UX 규칙

헤더: 좌측 로고, 중앙 네비(모바일은 메뉴 버튼 -> 드로어/시트), 우측 프로필/로그아웃.

카드형 리스트 + 테이블 혼합(모바일: 카드, 데스크톱: 테이블).

입력 폼: 라벨/플레이스홀더/필수표시/에러메시지 일관화.

너비/폰트/아이콘 크기 브레이크포인트:

<= 420px 초소형, <= 768px 모바일, <= 1024px 태블릿, > 1024px 데스크톱.

3D 배경: 장면 렌더 캔버스는 z-index 최하단 + 메인 콘텐츠는 반투명 카드(blur)로 미래감 부여. FPS 30 제한/해상도 스케일링.

5) 공통 데이터/권한 모델(Firestore)
5.1 사용자/권한

users/{uid}: { displayName, role: "user" | "admin" | "dev", createdAt }

회원가입 시 displayName = 본인이름 저장(채팅/작성자명에 사용).

관리자/개발자 권한은 admin 화면에서 설정.

접근 규칙:

본인 작성 문서만 update/delete 가능.

admin/dev는 모든 문서 read/write.

5.2 컬렉션(요구기능별)

posts (게시판) : { title, content, isPinned, createdBy, createdAt, updatedAt }

chat (채팅) : { text, createdBy, displayName, createdAt }

linen_in (입고) : { building, date, staffName, items:[{type, qty}], note, photos[], createdBy, createdAt }

linen_out (반품) : 구조는 linen_in 동일

history (내역 통합 뷰용) : 위 두 컬렉션을 합쳐서 쿼리(또는 뷰 전용 인덱스 컬렉션 history_index)

lost_items (분실물) : { building, date, room, status: "보관중"|"폐기"|"회수", memo, photos[], staffName, createdBy, createdAt }

maintenance (유지보수) : { building, date, room, status:"점검중"|"완료", memo, photos[], staffName, createdBy, createdAt }

orders (주문요청) : { requesterName, building, items:[{ name, qty, note, amazonSearchQuery, amazonUrl }], memo, status:"확인중"|"완료"|"거절", createdBy, createdAt }

worklog (근무기록) : { uid, displayName, day(YYYY-MM-DD), state:"휴무"|"출근"|"청소중"|"청소완료"|"퇴근", startedAt, breakMins, endedAt, totalWorkMins }

notices (공지사항) : { title, content, isActive, createdAt }

린넨 종류 드롭다운(8종):
싱글 이불 커버 / 싱글 매트 커버 / 더블 이불 커버 / 더블 매트 커버 / 더블 매트 커버(고무) / 배게 커버 / 수건타월 / 발 매트

5.3 인덱스/검색

날짜/건물/작성자/상태 조합 인덱스 생성.

텍스트 검색은 기본 where + client filter(간단) 사용.

6) Firestore 보안 규칙(개요)

로그인 필요.

문서별 createdBy == request.auth.uid일 때만 update/delete 허용.

roles/{uid} 또는 users/{uid}.role in ["admin","dev"]는 모든 문서 허용.

채팅/게시판/주문요청 등 스팸 방지: 서버시간 기준 생성 간 최소 간격(rate limit)은 Cloud Functions로 검증 가능.

7) Cloud Functions(개요)

자정 리셋(근무기록): 매일 00:00 JST에 worklog 상태를 “휴무”로 초기화하고, 당일 기록 집계 저장.

내역 인덱스 갱신: linen_in/linen_out 생성/수정 시 history_index 업데이트.

공지사항 푸시(선택): PWA 구독 시 WebPush 송출(추후).

8) 모듈별 UI/기능 사양
8.1 공통

상단 네비: 게시판 / 채팅 / 관리 / 린넨 입고등록 / 린넨 반품등록 / 내역 / 분실물관리 / 유지보수 관리 / 주문요청 / 근무기록 / 내정보 / 공지사항(읽기) / 관리자(어드민)

모바일: “메뉴” 버튼 → 드롭다운/드로어로 전체 메뉴 표시.

하단 푸터: 항상 HARU_KIM HYUN JUN.

파일/카메라 업로드: accept="image/*" capture="environment"로 모바일 카메라 즉시 호출 지원.

작성자명 자동: 로그인 사용자 displayName 자동 기입.

8.2 게시판

글 목록/상세/작성/수정/삭제.

본인글만 수정/삭제, 관리자 전권.

공지로 고정 체크박스(리스트 상단 고정).

8.3 채팅

기존 기능 유지.

회원가입 displayName 사용해 발화자 표시.

날짜·시간 실시간(serverTimestamp → 클라 포맷).

자동 스크롤/신규 메시지 하이라이트.

8.4 관리(린넨 집계)

입고/반품 자동 연동, 건물/날짜 필터.

총 입고 수량, 총 반품 수량, 순입고(입고-반품) 집계 표시.

CSV/Excel/PDF 내보내기.

8.5 린넨 입고등록 / 반품등록

공통 폼: 건물(드롭다운), 날짜, 담당자(자동), 린넨 항목 추가 버튼(행 추가), 각 행 종류(8종 드롭다운) + 수량 입력, 메모(선택), 사진(첨부/카메라/앨범).

제출 후 토스트/리셋, 기록은 history에서 확인 가능.

8.6 내역

입고/반품 전체 데이터 깔끔 뷰(모바일 카드, 데스크톱 테이블).

수정/삭제 버튼: 본인 기록만, 관리자는 전체.

CSV/Excel/PDF 내보내기.

8.7 분실물관리

필터: 건물/날짜/상태, 검색 초기화.

등록/보기/수정/삭제(권한 준수).

상태: 보관중/폐기/회수.

사진 업로드, 메모, 객실(수동), 건물(8개 드롭다운).

8.8 유지보수 관리

분실물과 동일 구조.

상태: 점검중/완료.

8.9 주문요청

요청자(자동), 건물(8개 드롭다운), 품목 행 추가: 제품명/수량/메모/검색연동필드.

일본 아마존 고정 검색: 일본어 키워드 입력 → 새 탭/내장패널로 아마존 검색 열기, 선택 시 링크/키워드 자동 기입.

하단에 주문요청 내역 리스트(상태 드롭다운: 확인중/완료/거절).

사무실 관리자만 상태 변경 가능(권한 체크).

8.10 근무기록

모든 사용자 자동 등록.

버튼: 출근 → 청소중 → 청소완료 → 퇴근.

해당 상태만 활성화(다음 단계로만 이동).

실시간 현황판: 출근 누른 사람만 근무중 목록, 나머지는 자동 휴무.

매일 자정 자동 리셋.

본인 하단 내역: 본인만 열람. 관리자는 전체 열람.

8.11 내정보

본인 프로필 수정/탈퇴(본인만).

관리자는 전체 권한(강제탈퇴 포함은 관리자 화면에서).

8.12 공지사항

관리자만 등록/수정/활성화.

로그인/앱 사용 시 첫 화면 모달로 노출, 아래에 닫기 버튼.

8.13 관리자(어드민)

버튼은 관리자만 표시.

공지 송출/활성화 토글.

사용자 목록/권한 부여/삭제(개발자 권한은 개발자와 동등 권한).

사용자 강제 탈퇴(가입 사용자 한정).

9) PWA 사양

manifest.json: 이름/짧은이름/아이콘(192/512)/start_url/standalone/배경/테마 색상.

service-worker.js:

App shell, 정적 자산 Cache First.

API/Firestore 네트워크 우선 + 실패 시 캐시 폴백 제한.

iOS 설치 배너 안내(가이드 토스트).

10) 성능/접근성/테스트

성능: 3D 배경 FPS 제한, 저사양 자동 폴백.

이미지 업로드 시 리사이즈/압축 옵션(클라 또는 Storage Rules).

접근성: 폼 라벨/aria, 키보드 포커스, 명도 대비.

E2E 체크리스트:

모바일(iOS Safari/Android Chrome) & PC 크로스 테스트.

각 모듈 CRUD/권한/필터/내보내기 동작 확인.

PWA 설치/오프라인 캐시/재방문 속도.

11) 마이그레이션 지시

기존 zip 업로드 후 엔트리 HTML 보존.

기존 스크립트 호출부 유지 → 신규 /scripts/core/*.js 유틸을 뒤에서 로드하고 어댑터로 기존 함수에 주입.

기존 Firestore 경로/문서필드 읽기 우선. 새 필드는 optional로 추가.

UI는 기존 id/class를 감싸는 래퍼 컴포넌트로 스타일만 교체(로직 불변).

문제가 되는 중복/글자겹침은 CSS 레이아웃 유틸로 교정.

12) 완료 기준(DoD)

모든 기존 기능 동작 동일 + 신규 기능 항목 전부 구현.

모바일/PC 겹침/깨짐 없음.

푸터에 “HARU_KIM HYUN JUN” 상시 노출.

PWA 설치 가능(iOS/Android), 오프라인 특정 화면 캐시 정상.

각 모듈의 권한 규칙 및 내보내기(CSV/Excel/PDF) 동작.

추가 구현 메모(개발자용)

Three.js 배경: 저사양 감지(navigator.hardwareConcurrency, performance.memory 유무, FPS 샘플) → 폴백.

Amazon JP 검색: https://www.amazon.co.jp/s?k=${encodeURIComponent(query)} 새 탭 또는 내장 iframe 뷰어(정책상 결제는 외부).

날짜는 JST 기준, Firestore에는 serverTimestamp() 저장 후 클라에서 포맷.

엑셀/CSV/PDF 내보내기: 현재 필터/정렬 상태 그대로 반영.